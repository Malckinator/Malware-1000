#ifndef CPU_H
#define CPU_H

#include <stdint.h>
#include <stdbool.h>
#include "../include/bus.h"

typedef struct PermTableStruct {
	char permLevel;
	DWORD start;
	DWORD size;
} PermTable;

typedef struct MW1000Struct {
	// Memory
	PermTable permTables[8];

	// Registers
	DWORD gpio[16];
	DWORD gpregs[16];
	DWORD pc;
	DWORD sp;
	BYTE permission;

	// Status Register

    struct
    {
        unsigned int cFlag:1;
	    unsigned int zFlag:1;
	    unsigned int oFlag:1;
	    unsigned int iFlag:1;
        unsigned int dFlag:1;
        unsigned int sFlag:1;
        unsigned int pFlag:1;
    } status;

    bool interrupt; //An interrupt is happening
} MW1000;

void pushInternal(MW1000* cpu, DWORD data);
DWORD popInternal(MW1000* cpu);
bool HasPermission(MW1000* cpu, DWORD addr);
DWORD FloatToInt(float f);
float IntToFloat(DWORD i);
bool RunInstruction(MW1000* cpu);
MW1000* CreateMW1000(Bus* bus);
void DestroyMW1000(MW1000* cpu);
#endif
